<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dự báo thời tiết theo ngày</title>

  <link rel="icon" href="../sanphamcuoikhoa/assets/images/logo.png" type="image/png">
  <link rel="stylesheet" href="./sanphamcuoikhoa/css/forecast.css">

  <!-- Font Awesome & Bootstrap -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <!-- ===== HEADER / NAVBAR ===== -->
  <header class="header">
    <div class="logo">
      <img src="../sanphamcuoikhoa/assets/images/logo.png" alt="logo">
      Weather
    </div>
    <nav class="nav">
      <div class="menu-toggle">
        <i class="fa-solid fa-bars"></i>
      </div>
      <div class="nav-container">
        <ul class="nav-links">
          <li><a href="index.html">Trang chủ</a></li>
          <li><a href="forecast.html">Thời tiết theo ngày</a></li>
          <li><a href="khuvuc.html" class="active">Dự báo theo khu vực</a></li>
        </ul>
      </div>
    </nav>
  </header>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="container text-center">
    <div class="weather-box">
      <h2>Dự báo thời tiết theo ngày</h2>
      <p>Nhập tên thành phố để xem dự báo:</p>
      <input type="text" id="city" placeholder="VD: Hanoi">
      <button onclick="getWeather()">Xem dự báo</button>

      <div id="result" class="mt-4"></div>
    </div>
  </main>

  <!-- ===== SCRIPT ===== -->
  <script>
    const API_KEY = 'a561ac9370b45d737811c14263ff46a3'; 

    async function getWeather() {
      const city = document.getElementById('city').value.trim();
      const result = document.getElementById('result');
      if (!city) {
        result.innerHTML = '<p>Vui lòng nhập tên thành phố.</p>';
        return;
      }

      result.innerHTML = '<p>Đang tải dữ liệu...</p>';

      try {
        const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${city}&limit=1&appid=${API_KEY}`);
        const geoData = await geoRes.json();

        if (!geoData || geoData.length === 0) {
          result.innerHTML = '<p>Không tìm thấy thành phố.</p>';
          return;
        }

        const { lat, lon, name, country } = geoData[0];

        // Lấy dự báo thời tiết (5 ngày / 3 giờ)
        const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&lang=vi&appid=${API_KEY}`);
        const weatherData = await weatherRes.json();

        // Gom dữ liệu theo ngày
        const dailyData = {};
        weatherData.list.forEach(item => {
          const date = item.dt_txt.split(' ')[0];
          if (!dailyData[date]) dailyData[date] = [];
          dailyData[date].push(item);
        });

        // Hiển thị kết quả
        let html = `<h4>${name}, ${country}</h4><ul>`;
        Object.keys(dailyData).forEach(date => {
          const dayData = dailyData[date];
          const temps = dayData.map(d => d.main.temp);
          const avgTemp = (temps.reduce((a, b) => a + b, 0) / temps.length).toFixed(1);
          const desc = dayData[0].weather[0].description;
          const icon = dayData[0].weather[0].icon;
          html += `
            <li>
              <img src="https://openweathermap.org/img/wn/${icon}.png" alt="">
              <strong>${new Date(date).toLocaleDateString('vi-VN')}</strong>:
              ${desc}, Nhiệt độ trung bình: ${avgTemp}°C
            </li>`;
        });
        html += '</ul>';

        result.innerHTML = html;
      } catch (err) {
        result.innerHTML = `<p>Lỗi khi lấy dữ liệu: ${err.message}</p>`;
      }
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  <script>
      window.embeddedChatbotConfig = {
        chatbotId: "EhJFa1z5wAUX8mBw5bJ_v",
        domain: "www.chatbase.co"
      }
    </script>
    <script
      src="https://www.chatbase.co/embed.min.js"
      chatbotId="EhJFa1z5wAUX8mBw5bJ_v"
      domain="www.chatbase.co"
      defer>
    </script>
</body>
</html>
